<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>GameOfLife</title>
    </head>

    <body onload="init()">
        <canvas id="canvas" width="800" height="800"></canvas>
    </body>
    <script type="text/javascript">
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    var board = [];

    function init(){
        initGrid();
        initBoard();
    }
    function initGrid(){
        ctx.fillStyle="black";
        ctx.fillRect(0,0,canvas.width,canvas.height);
        drawGrid();
    }
    function initBoard(){
		for (var x = 0; x < canvas.width/20; x++) {
            board[x] = [];
			for (var y = 0; y < canvas.height/20; y++) {
				board[x][y] = 0;
			}
		}
    }

    canvas.addEventListener('click', function(evt) {
        var mousePos = getMousePos(canvas, evt);
        changeCell(mousePos);
     }, false);

     document.addEventListener('keypress',function(evt){
         if(evt.keyCode == "32"){
            nextGen();
         }
     },false);

     function getMousePos(canvas, evt) {
         var rect = canvas.getBoundingClientRect();
         return {x: evt.clientX - rect.left, y: evt.clientY - rect.top};
       }

    function changeCell(mousePos){
        if(board[parseInt(mousePos.x/20)][parseInt(mousePos.y/20)] == 0){
            board[parseInt(mousePos.x/20)][parseInt(mousePos.y/20)] = 1;
            ctx.fillStyle="white";
            ctx.fillRect( parseInt(mousePos.x/20)*20+0.75, parseInt(mousePos.y/20)*20+0.75,18.75,18.5);
        }else {
            board[parseInt(mousePos.x/20)][parseInt(mousePos.y/20)] = 0;
            ctx.fillStyle="black";
            ctx.fillRect( parseInt(mousePos.x/20)*20+0.75, parseInt(mousePos.y/20)*20+0.75,18.75,18.5);
        }
    }

    function nextGen(){
        var boardNext = [];
        for (var i = 0; i < canvas.height/20; i++) {
            boardNext[i] = [];
		}
        for (var x = 0; x < board.length; x++) {
            for (var y = 0; y < board[x].length; y++) {
                var n = 0;
                for (var dx = -1; dx <= 1; dx++) {
					for (var dy = -1; dy <= 1; dy++) {
						if ( dx == 0 && dy == 0){}
						else if (typeof board[x+dx] !== 'undefined' && typeof board[x+dx][y+dy] !== 'undefined' && board[x+dx][y+dy]) {
							n++;
						}
					}
				}
                var c = board[x][y];
				switch (n) {
					case 0:
					case 1:
						c = 0;
						break;
					case 2:
						break;
					case 3:
						c = 1;
						break;
					default:
						c = 0;
				}
				boardNext[x][y] = c;
			}
		}
		board = boardNext.slice();
        drawBoard();
    }

    function drawBoard(){
        for (var x = 0; x < board.length; x++) {
            for (var y = 0; y < board[x].length; y++) {
                if(board[x][y] == 1){
                    ctx.fillStyle="white";
                    ctx.fillRect( x*20+0.75, y*20+0.75,18.75,18.5);
                }else {
                    ctx.fillStyle="black";
                    ctx.fillRect( x*20+0.75, y*20+0.75,18.75,18.5);
                }
            }
        }
    }

    function drawGrid(){
        ctx.strokeStyle = "rgb(136, 136, 136)";
        ctx.beginPath();
        ctx.lineWidth = 1.5;
        for(var i=0; i<=canvas.height; i+=20) {
            ctx.moveTo(0, canvas.height-i);
            ctx.lineTo(canvas.width, canvas.height-i);
        }
        for(var i=0; i<=canvas.width; i+=20) {
            ctx.moveTo(canvas.width-i, 0);
            ctx.lineTo(canvas.width-i, canvas.height);
        }
        ctx.closePath();
        ctx.stroke();
    }



    </script>
</html>
